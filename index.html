<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grade Color Counter</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top left, #fbe9ff, #fff7e6);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 1.5rem;
    }

    .card {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 20px 44px rgba(0,0,0,0.18);
      padding: 2.6rem 3rem;
      width: 700px;
      max-width: 100%;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.6rem;
    }

    h1 {
      margin: 0;
      font-size: 2.3rem;
      color: #3c256b;
    }

    .clock-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #666;
      text-align: right;
      letter-spacing: 0.06em;
    }

    #clockValue {
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 6px;
      color: #444;
      text-align: right;
    }

    /* Flower Buttons */
    .buttons {
      display: flex;
      justify-content: space-between;
      gap: 1.2rem;
      flex-wrap: wrap;
      margin-bottom: 1.2rem;
    }

    .color-btn {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      box-shadow: 0 14px 26px rgba(0,0,0,0.28);
      color: #fff;
      font-weight: 700;
      font-size: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      line-height: 1.2;
      transition:
        transform 0.12s ease-out,
        box-shadow 0.12s ease-out,
        filter 0.12s ease-out;
    }

    .color-btn span.grade {
      font-size: 1rem;
      font-weight: 600;
      margin-top: 4px;
    }

    .color-btn:hover {
      transform: scale(1.08) translateY(-4px);
      box-shadow: 0 18px 34px rgba(0,0,0,0.32);
      filter: brightness(1.05);
    }

    @keyframes bloomPulse {
      0% { transform: scale(1); }
      40% { transform: scale(1.14); }
      100% { transform: scale(1); }
    }

    .color-btn.clicked {
      animation: bloomPulse 0.28s ease-out;
    }

    /* Undo / Reset */
    .actions {
      display: flex;
      gap: 0.8rem;
      margin-bottom: 1.4rem;
    }

    .action-btn {
      flex: 1;
      border-radius: 999px;
      padding: 1rem 1.2rem;
      font-size: 1.05rem;
      font-weight: 650;
      border: 1px solid #ddd;
      background: #ffffff;
      color: #444;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(0,0,0,0.14);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out;
    }

    .action-btn:active {
      transform: scale(0.97);
      box-shadow: 0 3px 8px rgba(0,0,0,0.22);
    }

    /* Output */
    .output-box {
      background: #faf7ff;
      border-radius: 14px;
      padding: 1.2rem 1.4rem;
      border: 1px solid #e0d7ff;
      margin-top: 0.6rem;
    }

    .output-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.6rem;
    }

    .output-title {
      font-size: 1.3rem;
      font-weight: 750;
      color: #3c256b;
    }

    .copy-btn {
      font-size: 0.95rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #3c256b;
      color: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.22);
    }

    .copy-btn:active {
      transform: scale(0.96);
    }

    #output {
      margin-top: 0.3rem;
      font-size: 1.15rem;
      color: #333;
      white-space: pre-line;
      outline: none;
      min-height: 4.2em;
      cursor: text;
    }

    .editable-hint {
      margin-top: 0.4rem;
      font-size: 0.9rem;
      color: #777;
    }

    /* Toggle for manage section */
    #toggleManageBtn {
      margin-top: 1rem;
      padding: 0.7rem 1.2rem;
      width: 100%;
      border-radius: 999px;
      border: none;
      background: #3c256b;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(0,0,0,0.18);
    }

    /* Manage Buttons panel: same bg/border as output box */
    #manageBox {
      margin-top: 1.2rem;
      background: #faf7ff;
      border-radius: 14px;
      border: 1px solid #e0d7ff;
      padding: 1.2rem 1.4rem;
    }

    .editor-title {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 0.8rem;
      color: #3c256b;
    }

    .editor-subtitle {
      font-weight: 600;
      font-size: 0.95rem;
      margin-top: 0.8rem;
      margin-bottom: 0.35rem;
      color: #4b5563;
    }

    .editor-field-group {
      margin-bottom: 0.5rem;
    }

    #manageBox label {
      display: block;
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 0.2rem;
    }

    #manageBox input,
    #manageBox select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 0.45rem 0.7rem;
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
    }

    #manageBox input[type="color"] {
      height: 2.1rem;
      padding: 0;
      cursor: pointer;
    }

    #manageBox input:focus,
    #manageBox select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.4);
    }

    .editor-buttons-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.6rem;
    }

    .editor-button {
      border-radius: 999px;
      border: none;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      padding: 0.75rem 0;
      text-align: center;
      box-shadow: 0 3px 8px rgba(0,0,0,0.18);
    }

    .editor-button.update {
      background: #4f46e5;
      width: 50%;
    }

    .editor-button.delete {
      background: #dc2626;
      width: 50%;
    }

    .editor-button.add {
      background: #0d6efd;
      width: 100%;
      margin-top: 0.6rem;
    }

    @media (max-width: 720px) {
      .card {
        padding: 2rem 1.4rem;
        width: 100%;
      }
      .buttons {
        justify-content: center;
      }
      .color-btn {
        width: 150px;
        height: 150px;
        font-size: 1.05rem;
      }
      .color-btn span.grade {
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>

<div class="card">
  <div class="top-row">
    <h1>Grade Color Counter</h1>
    <div>
      <div class="clock-label">Chicago Time</div>
      <div id="clockValue">--:--:--</div>
    </div>
  </div>

  <!-- Flower buttons container -->
  <div class="buttons" id="buttonsContainer"></div>

  <div class="actions">
    <button class="action-btn" id="undoBtn">Undo Last</button>
    <button class="action-btn" id="resetBtn">Reset All</button>
  </div>

  <div class="output-box">
    <div class="output-header-row">
      <div class="output-title">Current Count</div>
      <button class="copy-btn" id="copyBtn">Copy</button>
    </div>
    <div id="output" contenteditable="true"></div>
    <div class="editable-hint">You can edit this text before copying.</div>
  </div>

  <!-- toggle starts as "Manage Buttons", panel hidden by default -->
  <button id="toggleManageBtn">Manage Buttons</button>

  <div id="manageBox" style="display:none;">
    <div class="editor-title">Manage Buttons</div>

    <!-- Edit existing -->
    <div class="editor-subtitle">Edit existing button</div>

    <div class="editor-field-group">
      <label for="editSelect">Select button</label>
      <select id="editSelect"></select>
    </div>

    <div class="editor-field-group">
      <label for="editLabel">New label (e.g. Blue (Grade 4))</label>
      <input id="editLabel" type="text" placeholder="New label">
    </div>

    <div class="editor-field-group">
      <label for="editColor">Color</label>
      <input id="editColor" type="color" value="#d447a6">
    </div>

    <div class="editor-buttons-row">
      <button class="editor-button update" id="editSaveBtn">Update Button</button>
      <button class="editor-button delete" id="deleteBtn">Delete Button</button>
    </div>

    <!-- Add new -->
    <div class="editor-subtitle">Add new button</div>

    <div class="editor-field-group">
      <label for="addLabel">Label (e.g. Blue (Grade 4))</label>
      <input id="addLabel" type="text" placeholder="Blue (Grade 4)">
    </div>

    <div class="editor-field-group">
      <label for="addColor">Color</label>
      <input id="addColor" type="color" value="#00aaff">
    </div>

    <button class="editor-button add" id="addBtn">Add Button</button>
  </div>
</div>

<script>
  const STORE = "grade_color_counter_v1";

  let state = {
    buttons: [
      { id: "pink",   label: "Pink (Grade 2)",   color: "#d447a6", count: 0 },
      { id: "orange", label: "Orange (Grade 3)", color: "#ff8c00", count: 0 },
      { id: "purple", label: "Purple (Grade K)", color: "#8a2be2", count: 0 }
    ],
    lastClickedId: null
  };

  const buttonsContainer = document.getElementById("buttonsContainer");
  const outputEl = document.getElementById("output");
  const undoBtn = document.getElementById("undoBtn");
  const resetBtn = document.getElementById("resetBtn");
  const copyBtn = document.getElementById("copyBtn");
  const toggleManageBtn = document.getElementById("toggleManageBtn");
  const manageBox = document.getElementById("manageBox");

  const editSelect = document.getElementById("editSelect");
  const editLabelInput = document.getElementById("editLabel");
  const editColorInput = document.getElementById("editColor");
  const editSaveBtn = document.getElementById("editSaveBtn");
  const deleteBtn = document.getElementById("deleteBtn");

  const addLabelInput = document.getElementById("addLabel");
  const addColorInput = document.getElementById("addColor");
  const addBtn = document.getElementById("addBtn");

  function saveState() {
    localStorage.setItem(STORE, JSON.stringify(state));
  }

  function loadState() {
    const saved = localStorage.getItem(STORE);
    if (!saved) return;
    try {
      const data = JSON.parse(saved);
      if (Array.isArray(data.buttons) && data.buttons.length > 0) {
        state.buttons = data.buttons;
      }
      state.lastClickedId = data.lastClickedId || null;
    } catch (e) {
      console.error("Error loading state", e);
    }
  }

  function baseName(label) {
    const idx = label.indexOf("(");
    return idx === -1 ? label.trim() : label.slice(0, idx).trim();
  }

  function updateOutput() {
    const lines = state.buttons.map(b => `${baseName(b.label)}: ${b.count}`);
    outputEl.textContent = lines.join("\n");
    saveState();
  }

  function bloom(id) {
    const btn = document.getElementById(id);
    if (!btn) return;
    btn.classList.remove("clicked");
    void btn.offsetWidth;
    btn.classList.add("clicked");
  }

  function renderButtons() {
    buttonsContainer.innerHTML = "";
    state.buttons.forEach(b => {
      const btn = document.createElement("button");
      btn.id = b.id;
      btn.className = "color-btn";
      btn.style.background = b.color;

      const gradeMatch = b.label.match(/\(([^)]+)\)/);
      const gradeText = gradeMatch ? gradeMatch[1] : "";

      btn.innerHTML =
        `<span>${baseName(b.label)}</span>` +
        (gradeText ? `<span class="grade">(${gradeText})</span>` : "");

      btn.addEventListener("click", () => {
        b.count++;
        state.lastClickedId = b.id;
        updateOutput();
        bloom(b.id);
      });

      buttonsContainer.appendChild(btn);
    });
  }

  function populateEditor() {
    editSelect.innerHTML = "";
    state.buttons.forEach(b => {
      const opt = document.createElement("option");
      opt.value = b.id;
      opt.textContent = b.label;
      editSelect.appendChild(opt);
    });

    if (state.buttons.length > 0) {
      const first = state.buttons[0];
      editSelect.value = first.id;
      editLabelInput.value = first.label;
      editColorInput.value = first.color;
    }
  }

  editSelect.addEventListener("change", () => {
    const btnState = state.buttons.find(b => b.id === editSelect.value);
    if (!btnState) return;
    editLabelInput.value = btnState.label;
    editColorInput.value = btnState.color;
  });

  editSaveBtn.addEventListener("click", () => {
    const id = editSelect.value;
    const btnState = state.buttons.find(b => b.id === id);
    if (!btnState) return;
    const newLabel = editLabelInput.value.trim();
    const newColor = editColorInput.value || btnState.color;
    if (newLabel) btnState.label = newLabel;
    btnState.color = newColor;
    renderButtons();
    populateEditor();
    updateOutput();
    saveState();
  });

  deleteBtn.addEventListener("click", () => {
    if (state.buttons.length <= 1) {
      alert("You must have at least one button.");
      return;
    }
    const id = editSelect.value;
    const btnState = state.buttons.find(b => b.id === id);
    if (!btnState) return;
    if (!confirm(`Delete "${btnState.label}"?`)) return;
    state.buttons = state.buttons.filter(b => b.id !== id);
    if (state.lastClickedId === id) state.lastClickedId = null;
    renderButtons();
    populateEditor();
    updateOutput();
    saveState();
  });

  addBtn.addEventListener("click", () => {
    const label = addLabelInput.value.trim();
    const color = addColorInput.value || "#888888";
    if (!label) return;
    const id = "btn_" + Date.now();
    state.buttons.push({ id, label, color, count: 0 });
    addLabelInput.value = "";
    renderButtons();
    populateEditor();
    updateOutput();
    saveState();
  });

  undoBtn.addEventListener("click", () => {
    const id = state.lastClickedId;
    if (!id) return;
    const btnState = state.buttons.find(b => b.id === id);
    if (btnState && btnState.count > 0) {
      btnState.count--;
    }
    state.lastClickedId = null;
    updateOutput();
  });

  resetBtn.addEventListener("click", () => {
    state.buttons.forEach(b => (b.count = 0));
    state.lastClickedId = null;
    updateOutput();
  });

  copyBtn.addEventListener("click", async () => {
    const text = outputEl.innerText.trim();
    try {
      await navigator.clipboard.writeText(text);
      const oldText = copyBtn.textContent;
      copyBtn.textContent = "Copied!";
      setTimeout(() => (copyBtn.textContent = oldText), 1200);
    } catch {
      alert("Could not copy. You can select and copy manually.");
    }
  });

  // show/hide manage panel
  toggleManageBtn.addEventListener("click", () => {
    const isHidden = manageBox.style.display === "none";
    if (isHidden) {
      manageBox.style.display = "block";
      toggleManageBtn.textContent = "Hide";
    } else {
      manageBox.style.display = "none";
      toggleManageBtn.textContent = "Manage Buttons";
    }
  });

  // clock
  function updateClock() {
    const now = new Intl.DateTimeFormat("en-US", {
      hour: "numeric",
      minute: "2-digit",
      second: "2-digit",
      hour12: true,
      timeZone: "America/Chicago"
    }).format(new Date());
    document.getElementById("clockValue").textContent = now;
  }

  loadState();
  renderButtons();
  populateEditor();
  updateOutput();
  updateClock();
  setInterval(updateClock, 1000);
</script>

</body>
</html>
