<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grade Color Counter</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top left, #fbe9ff, #fff7e6);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 1.5rem;
    }

    .card {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 20px 44px rgba(0,0,0,0.18);
      padding: 2.6rem 3rem;
      width: 680px;
      max-width: 100%;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.6rem;
    }

    h1 {
      margin: 0;
      font-size: 2.3rem;
      color: #3c256b;
    }

    .clock-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #666;
      text-align: right;
      letter-spacing: 0.06em;
    }

    #clockValue {
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 6px;
      color: #444;
      text-align: right;
    }

    /* BIG FLOWER BUTTONS ROW */
    .buttons {
      display: flex;
      justify-content: space-between;
      gap: 1.2rem;
      flex-wrap: wrap;
      margin-bottom: 1.2rem;
    }

    .color-btn {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      box-shadow: 0 14px 26px rgba(0,0,0,0.28);
      color: #fff;
      font-weight: 700;
      font-size: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      line-height: 1.2;
      transition:
        transform 0.12s ease-out,
        box-shadow 0.12s ease-out,
        filter 0.12s ease-out;
    }

    .color-btn span.grade {
      font-size: 1rem;
      font-weight: 600;
      opacity: 0.95;
      margin-top: 4px;
    }

    /* Hover bloom effect */
    .color-btn:hover {
      transform: scale(1.08) translateY(-4px);
      box-shadow: 0 18px 34px rgba(0,0,0,0.32);
      filter: brightness(1.05);
    }

    /* Click bloom pulse animation */
    @keyframes bloomPulse {
      0%   { transform: scale(1); }
      40%  { transform: scale(1.14); }
      100% { transform: scale(1); }
    }

    .color-btn.clicked {
      animation: bloomPulse 0.28s ease-out;
    }

    /* Undo / Reset row */
    .actions {
      display: flex;
      gap: 0.8rem;
      margin-bottom: 1.4rem;
    }

    .action-btn {
      flex: 1;
      border-radius: 999px;
      padding: 1rem 1.2rem;
      font-size: 1.05rem;
      font-weight: 650;
      border: 1px solid #ddd;
      background: #ffffff;
      color: #444;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(0,0,0,0.14);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out;
    }

    .action-btn:active {
      transform: scale(0.97);
      box-shadow: 0 3px 8px rgba(0,0,0,0.22);
    }

    /* Output / copy area */
    .output-box {
      background: #faf7ff;
      border-radius: 14px;
      padding: 1.2rem 1.4rem;
      border: 1px solid #e0d7ff;
      margin-top: 0.6rem;
    }

    .output-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.6rem;
    }

    .output-title {
      font-size: 1.3rem;
      font-weight: 750;
      color: #3c256b;
    }

    .copy-btn {
      font-size: 0.95rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #3c256b;
      color: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.22);
    }

    .copy-btn:active {
      transform: scale(0.96);
    }

    #output {
      margin-top: 0.3rem;
      font-size: 1.15rem;
      color: #333;
      white-space: pre-line;
      outline: none;
      min-height: 4.2em;
      cursor: text;
    }

    .editable-hint {
      margin-top: 0.4rem;
      font-size: 0.9rem;
      color: #777;
    }

    /* MANAGE BUTTONS PANEL */
    .editor-box {
      margin-top: 1.4rem;
      padding: 1.1rem 1.3rem;
      border-radius: 14px;
      border: 1px dashed #cbd5f5;
      background: #f9fafb;
      font-size: 0.95rem;
    }

    .editor-title {
      font-weight: 700;
      margin-bottom: 0.6rem;
      color: #374151;
    }

    .editor-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .editor-column {
      flex: 1;
      min-width: 220px;
    }

    .editor-subtitle {
      font-weight: 600;
      margin-bottom: 0.35rem;
      color: #4b5563;
    }

    .editor-column label {
      display: block;
      margin-top: 0.4rem;
      font-size: 0.85rem;
      color: #6b7280;
    }

    .editor-column input,
    .editor-column select {
      width: 100%;
      margin-top: 0.2rem;
      padding: 0.45rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
    }

    .editor-column input:focus,
    .editor-column select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.4);
    }

    .editor-column input[type="color"] {
      padding: 0;
      height: 2.1rem;
      cursor: pointer;
    }

    .editor-buttons-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.6rem;
      flex-wrap: wrap;
    }

    .editor-button {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: #4f46e5;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(79, 70, 229, 0.35);
    }

    .editor-button.danger {
      background: #dc2626;
      box-shadow: 0 3px 8px rgba(220, 38, 38, 0.35);
    }

    .editor-button:active {
      transform: scale(0.97);
    }

    @media (max-width: 720px) {
      .card {
        padding: 2rem 1.4rem;
        width: 100%;
      }
      .buttons {
        justify-content: center;
      }
      .color-btn {
        width: 150px;
        height: 150px;
        font-size: 1.05rem;
      }
      .color-btn span.grade {
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>

<div class="card">
  <div class="top-row">
    <h1>Grade Color Counter</h1>
    <div>
      <div class="clock-label">Chicago Time</div>
      <div id="clockValue">--:--:--</div>
    </div>
  </div>

  <!-- Flower buttons container (filled by JS) -->
  <div class="buttons" id="buttonsContainer"></div>

  <div class="actions">
    <button class="action-btn" id="undoBtn">Undo Last</button>
    <button class="action-btn" id="resetBtn">Reset All</button>
  </div>

  <div class="output-box">
    <div class="output-header-row">
      <div class="output-title">Current Count</div>
      <button class="copy-btn" id="copyBtn">Copy</button>
    </div>
    <div id="output" contenteditable="true"></div>
    <div class="editable-hint">You can edit this text before copying.</div>
  </div>

  <!-- Manage Buttons / Editor -->
  <div class="editor-box">
    <div class="editor-title">Manage Buttons</div>

    <!-- EDIT EXISTING SECTION -->
    <div class="editor-row">
      <div class="editor-column">
        <div class="editor-subtitle">Edit existing button</div>

        <label for="editSelect">Select button</label>
        <select id="editSelect"></select>

        <label for="editLabel">New label (e.g. Blue (Grade 4))</label>
        <input id="editLabel" type="text" placeholder="New label">

        <label for="editColor">Color</label>
        <input id="editColor" type="color" value="#8a2be2">

        <div class="editor-buttons-row">
          <button class="editor-button" id="editSaveBtn">Update Button</button>
          <button class="editor-button danger" id="deleteBtn">Delete Button</button>
        </div>
      </div>
    </div>

    <hr style="border:none;height:1px;background:#e5e7eb;margin:1.2rem 0;">

    <!-- ADD NEW SECTION -->
    <div class="editor-row">
      <div class="editor-column">
        <div class="editor-subtitle">Add new button</div>

        <label for="addLabel">Label (e.g. Blue (Grade 4))</label>
        <input id="addLabel" type="text" placeholder="Blue (Grade 4)">

        <label for="addColor">Color</label>
        <input id="addColor" type="color" value="#00aaff">

        <button class="editor-button" id="addBtn">Add Button</button>
      </div>
    </div>
  </div>
</div>

<script>
  const STORE = "buttons_state_v2";

  let state = {
    buttons: [
      { id: "purple", label: "Purple (Grade K)", color: "#8a2be2", count: 0 },
      { id: "pink",   label: "Pink (Grade 2)",   color: "#ff69b4", count: 0 },
      { id: "orange", label: "Orange (Grade 3)", color: "#ff8c00", count: 0 }
    ],
    lastClickedId: null
  };

  const buttonsContainer = document.getElementById("buttonsContainer");
  const outputEl = document.getElementById("output");

  const editSelect = document.getElementById("editSelect");
  const editLabelInput = document.getElementById("editLabel");
  const editColorInput = document.getElementById("editColor");
  const editSaveBtn = document.getElementById("editSaveBtn");
  const deleteBtn = document.getElementById("deleteBtn");

  const addLabelInput = document.getElementById("addLabel");
  const addColorInput = document.getElementById("addColor");
  const addBtn = document.getElementById("addBtn");

  function saveState() {
    localStorage.setItem(STORE, JSON.stringify(state));
  }

  function loadState() {
    const saved = localStorage.getItem(STORE);
    if (!saved) return;
    try {
      const data = JSON.parse(saved);
      if (Array.isArray(data.buttons) && data.buttons.length > 0) {
        state.buttons = data.buttons;
      }
      if (data.lastClickedId) state.lastClickedId = data.lastClickedId;
    } catch (e) {
      console.error("Error loading state:", e);
    }
  }

  function getBaseName(label) {
    const idx = label.indexOf("(");
    if (idx === -1) return label.trim();
    return label.slice(0, idx).trim();
  }

  function updateOutput() {
    const lines = state.buttons.map(btn => {
      return `${getBaseName(btn.label)}: ${btn.count}`;
    });
    outputEl.textContent = lines.join("\n");
    saveState();
  }

  function bloom(id) {
    const btn = document.getElementById(id);
    if (!btn) return;
    btn.classList.remove("clicked");
    void btn.offsetWidth;
    btn.classList.add("clicked");
  }

  function renderButtons() {
    buttonsContainer.innerHTML = "";
    state.buttons.forEach(btn => {
      const el = document.createElement("button");
      el.className = "color-btn";
      el.id = btn.id;
      el.style.background = btn.color;

      const base = getBaseName(btn.label);
      const gradePartMatch = btn.label.match(/\(([^)]+)\)/);
      const gradeText = gradePartMatch ? `(${gradePartMatch[1]})` : "";

      el.innerHTML = `
        <span>${base}</span>
        ${gradeText ? `<span class="grade">${gradeText}</span>` : ""}
      `;

      el.addEventListener("click", () => {
        const target = state.buttons.find(b => b.id === btn.id);
        if (!target) return;
        target.count += 1;
        state.lastClickedId = btn.id;
        updateOutput();
        bloom(btn.id);
      });

      buttonsContainer.appendChild(el);
    });
  }

  function populateEditor() {
    editSelect.innerHTML = "";
    state.buttons.forEach(btn => {
      const opt = document.createElement("option");
      opt.value = btn.id;
      opt.textContent = btn.label;
      editSelect.appendChild(opt);
    });

    if (state.buttons.length > 0) {
      const selected = state.buttons[0];
      editSelect.value = selected.id;
      editLabelInput.value = selected.label;
      editColorInput.value = selected.color;
    } else {
      editLabelInput.value = "";
      editColorInput.value = "#8a2be2";
    }
  }

  editSelect.addEventListener("change", () => {
    const id = editSelect.value;
    const btn = state.buttons.find(b => b.id === id);
    if (!btn) return;
    editLabelInput.value = btn.label;
    editColorInput.value = btn.color;
  });

  editSaveBtn.addEventListener("click", () => {
    const id = editSelect.value;
    const btn = state.buttons.find(b => b.id === id);
    if (!btn) return;
    const newLabel = editLabelInput.value.trim();
    const newColor = editColorInput.value || btn.color;
    if (newLabel) btn.label = newLabel;
    btn.color = newColor;
    saveState();
    renderButtons();
    updateOutput();
    populateEditor();
  });

  // DELETE BUTTON
  deleteBtn.addEventListener("click", () => {
    if (state.buttons.length <= 1) {
      alert("You must have at least one button. Cannot delete the last one.");
      return;
    }
    const id = editSelect.value;
    const btn = state.buttons.find(b => b.id === id);
    if (!btn) return;

    const confirmDelete = confirm(`Delete "${btn.label}"? This will remove its button and count.`);
    if (!confirmDelete) return;

    state.buttons = state.buttons.filter(b => b.id !== id);
    if (state.lastClickedId === id) {
      state.lastClickedId = null;
    }
    saveState();
    renderButtons();
    populateEditor();
    updateOutput();
  });

  addBtn.addEventListener("click", () => {
    const label = addLabelInput.value.trim();
    const color = addColorInput.value || "#888888";
    if (!label) return;
    const id = "btn_" + Date.now();
    state.buttons.push({ id, label, color, count: 0 });
    addLabelInput.value = "";
    saveState();
    renderButtons();
    updateOutput();
    populateEditor();
  });

  document.getElementById("undoBtn").onclick = () => {
    const id = state.lastClickedId;
    if (!id) return;
    const btn = state.buttons.find(b => b.id === id);
    if (btn && btn.count > 0) {
      btn.count -= 1;
    }
    state.lastClickedId = null;
    updateOutput();
  };

  document.getElementById("resetBtn").onclick = () => {
    state.buttons.forEach(btn => (btn.count = 0));
    state.lastClickedId = null;
    updateOutput();
  };

  document.getElementById("copyBtn").onclick = async () => {
    const text = outputEl.innerText.trim();
    try {
      await navigator.clipboard.writeText(text);
      const btn = document.getElementById("copyBtn");
      const old = btn.textContent;
      btn.textContent = "Copied!";
      setTimeout(() => (btn.textContent = old), 1200);
    } catch (e) {
      alert("Could not copy. You can select and copy manually.");
    }
  };

  function updateClock() {
    const now = new Intl.DateTimeFormat("en-US", {
      hour: "numeric",
      minute: "2-digit",
      second: "2-digit",
      hour12: true,
      timeZone: "America/Chicago"
    }).format(new Date());
    document.getElementById("clockValue").textContent = now;
  }

  loadState();
  renderButtons();
  populateEditor();
  updateOutput();
  updateClock();
  setInterval(updateClock, 1000);
</script>

</body>
</html>